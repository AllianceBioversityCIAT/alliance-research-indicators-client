<div class="app-page-wrapper">
  <app-form-header />
  <div class="flex flex-col bg-[#fcfcfc] rounded-[10px] p-[30px] pb-[24px] mb-6">
    <div class="font-['Space_Grotesk'] text-[14px] font-medium text-[#8d9299] uppercase mb-[30px] mt-0">OICR DETAILS</div>
    <div class="grid gap-[15px]">
      <div class="flex flex-col xl:flex-row gap-[15px]">
        <app-input
          class="xl:max-w-50"
          label="OICR No"
          helperText="Internal code assigned by SPRM."
          [signal]="body"
          [disabled]="!submission.isEditableStatus()"
          placeholder="OICR No"
          optionValue="oicr_internal_code"></app-input>

        <app-select
          label="Tagging"
          class="flex-1"
          [helperText]="taggingHelperText"
          [isRequired]="true"
          [signal]="this.body"
          [optionValue]="{ body: 'tagging[0].tag_id', option: 'id' }"
          optionLabel="name"
          serviceName="tags"
          scrollHeight="132px"
          placeholder="Select the tagging"></app-select>
      </div>

      @if (body().tagging[0]?.tag_id === 2 || body().tagging[0]?.tag_id === 3) {
        <div class="flex flex-col">
          <app-select
            label="Select existing OICR"
            helperText="Select an OICR previously reported in the Alliance."
            [signal]="this.body"
            [optionValue]="{ body: 'link_result.external_oicr_id', option: 'result_official_code' }"
            optionLabel="title"
            serviceName="oicrResults"
            placeholder="Select OICR"
            scrollHeight="295px"
            [hideSelected]="false"
            textSpan="OICR selected">
            <ng-template #item let-item>
              <div class="flex flex-col gap-2 h-[54px] text-[14px] w-full min-w-0" pTooltip="{{ item?.title }}">
                <p class="text-[#4C5158] font-[400] w-full overflow-hidden whitespace-nowrap text-ellipsis">
                  <b>{{ item?.id }} -</b>
                  {{ item?.title }}
                </p>

                <p class="space-x-2 text-[11px] text-[#777C83] !font-['Space_Grotesk']">
                  <button class="uppercase max-w-24 text-[10px] font-semibold px-2 py-1 rounded-lg border border-[#7CB580] text-[#358540]">
                    Published
                  </button>
                  Maturity level <i class="pi pi-arrow-right !text-[8px] text-[#777C83] pl-1"></i>
                  <span class="text-[#345B8F]">{{ item?.maturity_level }}</span>
                  <span class="text-[#B9C0C5]">|</span>
                  Reporting year <i class="pi pi-arrow-right !text-[8px] text-[#777C83] pl-1"></i>
                  <span class="text-[#345B8F]">{{ item?.report_year }}</span>
                </p>
              </div>
            </ng-template>
            <ng-template #rows let-item>
              <div class="flex h-[82px] text-[14px] w-full min-w-0 px-2 py-0.5">
                <div class="w-[90%] flex flex-col gap-2">
                  <div class="flex items-center gap-2">
                    <i class="pi pi-chart-pie !text-[12px] text-[#F58220]"></i>
                    <span class="text-[11px] text-[#8D9299] font-[400] !font-[Space_Grotesk]">OICR</span>
                  </div>
                  <div class="text-[#4C5158] font-[600] w-full overflow-hidden whitespace-nowrap text-ellipsis" pTooltip="{{ item?.title }}">
                    {{ item?.id }} -
                    {{ item?.title }}
                  </div>
                  <p class="space-x-2 text-[11px] text-[#777C83] !font-['Space_Grotesk']">
                    <button class="uppercase max-w-24 text-[10px] font-semibold px-2 py-1 rounded-lg border border-[#7CB580] text-[#358540]">
                      Published
                    </button>
                    Maturity level <i class="pi pi-arrow-right !text-[8px] text-[#777C83] pl-1"></i>
                    <span class="text-[#345B8F]">{{ item?.maturity_level }}</span>
                    <span class="text-[#B9C0C5]">|</span>
                    Reporting year <i class="pi pi-arrow-right !text-[8px] text-[#777C83] pl-1"></i>
                    <span class="text-[#345B8F]">{{ item?.report_year }}</span>
                  </p>
                </div>
                <div class="flex w-[10%] justify-end items-center">
                  <i
                    class="pi pi-times-circle !text-[18px] text-[#CF0808] pl-1"
                    (keydown.enter)="clearOicrSelection()"
                    (click)="clearOicrSelection()"></i>
                </div>
              </div>
            </ng-template>
            <ng-template #selectedItemTemplate let-selected>
              <span>OICR selected</span>
            </ng-template>
          </app-select>
        </div>
      }
      <div class="flex flex-col">
        <app-select
          label="Maturity of change reported"
          class="flex-1"
          [helperText]="maturityLevelHelperText"
          [signal]="this.body"
          [optionValue]="{ body: 'maturity_level_id', option: 'id' }"
          optionLabel="name"
          serviceName="maturityLevels"
          scrollHeight="132px"
          placeholder="Select an option">
          <ng-template #selectedItemTemplate let-value>
            <div class="flex items-center gap-2 text-[##4C5158]">
              <span class="font-[600]">
                {{ value?.name }}: <span class="font-['Barlow'] font-normal">{{ value?.description }}</span></span
              >
            </div>
          </ng-template>

          <ng-template #item let-item>
            <div class="flex items-center gap-2 text-[##4C5158]">
              <span class="font-[600]">
                {{ item?.name }}: <span class="font-['Barlow'] font-normal">{{ item?.description }}</span></span
              >
            </div>
          </ng-template>
        </app-select>
      </div>
      <div class="flex flex-col">
        <app-textarea
          [rows]="5"
          label="Elaboration of outcome/impact statement"
          [helperText]="outcomeImpactStatementHelperText"
          [maxLength]="400"
          [signal]="this.body"
          [optionValue]="'outcome_impact_statement'"
          placeholder="Write the elaboration of outcome / impact statement"></app-textarea>
      </div>

      <div class="flex flex-col">
        <app-textarea
          [isRequired]="true"
          [rows]="5"
          label="Short Outcome/Impact Statement"
          [helperText]="
            'AI will draft a short outcome statement using the text from the Elaboration of outcome/impact statement field above. You can edit it anytime.'
          "
          [maxLength]="80"
          [signal]="this.body"
          [optionValue]="'short_outcome_impact_statement'"
          placeholder="Write the short outcome"></app-textarea>
      </div>
    </div>
  </div>

  <app-navigation-buttons [showNext]="false" (back)="saveData('back')" (save)="saveData()" />
</div>
