<div class="flex flex-col mx-[40px] my-[30px]">
  <h3 class="font-['Inter'] text-[15px] font-bold leading-[18px] text-[#173f6f] uppercase mb-0">{{ this.cache.currentMetadata().result_title }}</h3>
  <br />

  <div class="flex flex-col bg-[#fcfcfc] rounded-[10px] p-[30px] mb-5">
    <div class="font-['Space_Grotesk'] text-xs font-medium text-[#8d9299] uppercase mb-[30px] mt-0">GEOGRAPHIC SCOPE</div>
    <div class="flex items-center bg-[#e8ebed] border-l-[5px] border-l-[#074b86] gap-5 px-5 mb-[30px]">
      <span class="text-[#074b86] material-symbols-rounded">info</span>
      <h3 class="text-[#777c83] font-['Barlow'] text-[14px] font-normal leading-[17px] text-left my-[15px]">
        Select the geographic location/s where this result is taking place.
      </h3>
    </div>

    <div class="flex justify-between items-start w-full">
      <div class="information"></div>
    </div>

    <div class="flex flex-col gap-5">
      <app-radio-button
        label="What is the main geographic focus of the Impact?*"
        description="This should reflect where the Impact has taken place/contributed to benefit."
        [signal]="body"
        [optionLabel]="'label'"
        serviceName="geoFocus"
        (selectEvent)="onSelect()"
        [optionValue]="{ body: 'geo_scope_id', option: 'value' }"></app-radio-button>

      @if (getMultiselectLabel().region.label) {
        <app-multiselect
          [signal]="body"
          [optionLabel]="'name'"
          [optionValue]="'region_id'"
          [signalOptionValue]="'regions'"
          serviceName="regions"
          label="{{ getMultiselectLabel().region.label }}"
          description="{{ getMultiselectLabel().region.description }}"></app-multiselect>
      }
      @if (getMultiselectLabel().country.label) {
        <app-multiselect
          (selectEvent)="onSelect()"
          [signal]="body"
          [flagAttributes]="{ isoAlpha2: 'isoAlpha2', institution_location_name: 'name' }"
          [disabledSelectedScroll]="body().geo_scope_id === 5 || body().geo_scope_id === '5'"
          [optionLabel]="'name'"
          [optionValue]="'isoAlpha2'"
          [signalOptionValue]="'countries'"
          serviceName="countries"
          label="{{ getMultiselectLabel().country.label }}"
          description="{{ getMultiselectLabel().country.description }}">
          @if (body().geo_scope_id === 5 || body().geo_scope_id === '5') {
            <ng-template #rows let-country>
              <div class="flex justify-between items-start py-3 w-full">
                <div class="flex flex-col gap-3 max-w-[70%]">
                  <div class="flex items-center gap-3">
                    <img [src]="environment.flagsUrl + country.isoAlpha2 + '.svg'" [alt]="country.name" class="w-6 h-4 object-cover" />
                    <span class="font-medium text-[var(--text-color)]">{{ country.name }}</span>
                  </div>
                  <div class="sub-national-section">
                    <div class="flex flex-wrap gap-2 items-center">
                      <span class="text-[#777c83] text-[13px]">Sub-national levels</span>
                      <i class="pi pi-arrow-right !text-[12px] text-[#8d9299]"></i>
                      @for (region of country.result_countries_sub_nationals_signal().regions; track region.sub_national_id) {
                        <div class="bg-[#e5e7eb] rounded-full px-3 py-1 flex items-center gap-2 text-[13px] text-[#4c5158]">
                          {{ region.name }}
                          <i
                            class="pi pi-times !text-[12px] text-[#8d9299] hover:text-[#4c5158] cursor-pointer"
                            (click)="subnationalmultiselect.removeOption(region)"></i>
                        </div>
                      }
                    </div>
                  </div>
                </div>

                <!-- Right column: Multiselect -->
                <div class="w-[300px]">
                  <app-multiselect-instance
                    #subnationalmultiselect
                    [signal]="country.result_countries_sub_nationals_signal"
                    [optionLabel]="'name'"
                    [optionValue]="'sub_national_id'"
                    [signalOptionValue]="'regions'"
                    serviceName="GetSubnationalByIsoAlpha"
                    [hideSelected]="true"
                    [endpointParams]="{ isoAlpha2: country.isoAlpha2 }"></app-multiselect-instance>
                </div>
              </div>
            </ng-template>
          }
        </app-multiselect>
      }
    </div>
  </div>
  <div class="flex gap-5">
    <p-button (click)="saveData('back')" label="Back" icon="pi pi-arrow-left" iconPos="left" [loading]="this.loading()" />
    <p-button (click)="saveData('next')" label="Next" icon="pi pi-arrow-right" iconPos="left" [loading]="this.loading()" />
    <p-button (click)="saveData()" label="Save" severity="success" icon="pi pi-save" iconPos="left" [loading]="this.loading()" />
  </div>
</div>
