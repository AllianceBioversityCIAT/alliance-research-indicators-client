<p-table
  [value]="setUpProjectService.strcutureGrouped()"
  sortField="representative.name"
  sortMode="single"
  dataKey="representative.name"
  size="small"
  rowGroupMode="subheader"
  groupRowsBy="representative.code"
  [tableStyle]="{ 'min-width': '70rem' }">
  <ng-template #header>
    <tr>
      <th></th>
      <th style="width: 20%">Code</th>
      <th style="width: 20%">name</th>
      <th style="width: 60%">indicators</th>
      <th style="width: 10%">actions</th>
    </tr>
  </ng-template>
  <ng-template #groupheader let-customer let-rowIndex="rowIndex" let-expanded="expanded">
    <tr>
      <td>
        <button
          type="button"
          pButton
          pRipple
          [pRowToggler]="customer"
          text
          rounded
          plain
          class="mr-2"
          [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
      </td>
      <td>{{ customer.representative.code }}</td>
      <td>
        @if (customer.representative.editing) {
          <input type="text" pInputText [(ngModel)]="nameInput" />
        } @else {
          <p-tag [value]="customer.representative.name" severity="info" />
        }
      </td>
      <td>
        <app-table-indicator-item [indicators]="customer.indicators" />
      </td>
      <td>
        <div class="flex gap-2">
          @if (customer.representative.editing) {
            <p-button
              (click)="saveEditingLevel1(customer)"
              icon="pi pi-save"
              pTooltip="Save"
              tooltipPosition="left"
              severity="primary"
              [text]="true"
              size="small">
            </p-button>
            <p-button
              (click)="changeEditingLevel1(customer)"
              icon="pi pi-times"
              pTooltip="Cancel"
              tooltipPosition="left"
              severity="danger"
              [text]="true"
              size="small">
            </p-button>
          } @else {
            <p-button
              (click)="changeEditingLevel1(customer)"
              icon="pi pi-pencil"
              pTooltip="Edit"
              tooltipPosition="left"
              severity="primary"
              [text]="true"
              size="small">
            </p-button>
            <p-button icon="pi pi-trash" pTooltip="Delete" tooltipPosition="left" severity="danger" [text]="true" size="small"> </p-button>
          }
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template #groupfooter let-customer>
    <tr class="p-rowgroup-footer">
      <td colspan="5" style="text-align: center">Total {{ setUpProjectService.level2Name() }}: {{ customer.representative.itemsCount }}</td>
    </tr>
  </ng-template>
  <ng-template #expandedrow let-customer>
    <tr style="background-color: #f4f7ff">
      <td></td>
      <td>
        {{ customer.code }}
      </td>
      <td>
        <div>value:{{ customer.editing }}</div>
        @if (customer.editing) {
          <input type="text" pInputText [(ngModel)]="customer.name" />
        } @else {
          <p-tag [value]="customer.name" severity="info" />
        }
      </td>
      <td><app-table-indicator-item [indicators]="customer.indicators" /></td>
      <td>
        <div class="flex gap-2">
          <p-button icon="pi pi-pencil" pTooltip="Edit" tooltipPosition="left" severity="primary" [text]="true" size="small"> </p-button>
          <p-button icon="pi pi-trash" pTooltip="Delete" tooltipPosition="left" severity="danger" [text]="true" size="small"> </p-button>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>
