<p-dialog
  [(visible)]="setUpProjectService.assignIndicatorsModal().show"
  (onHide)="setUpProjectService.assignIndicatorsModal.set({ show: false, target: { type: 'item', structureIndex: -1, itemIndex: -1 } })"
  header="Add Indicators"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '720px' }"
  [draggable]="false">
  @if (targetInfo(); as target) {
    <div class="assign-indicators">
      <div class="mb-4">
        <!-- <p class="text-sm text-gray-700 mb-3">
          Create a new indicator for this <strong>{{ target.type }}</strong>
        </p>

        <p-button
          icon="pi pi-plus"
          label="Assign New Indicator"
          severity="secondary"
          size="small"
          class="w-full mb-3"
          (onClick)="setUpProjectService.manageIndicatorModal.set({ show: true })">
        </p-button> -->
      </div>

      <div class="available-indicators">
        <h4 class="font-medium text-gray-800 mb-3">Available indicators ({{ getIndicatorsFiltered().length }})</h4>

        @if (getIndicatorsFiltered().length) {
          <div class="space-y-3 max-h-80 overflow-y-auto">
            @for (indicator of getIndicatorsFiltered(); track indicator.id) {
              <div
                class="border border-gray-200 rounded-lg p-3 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors"
                (click)="setUpProjectService.assignIndicator(indicator)">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <h5 class="font-medium text-gray-800 text-sm mb-1">{{ indicator.name }}</h5>
                    <p class="text-xs text-gray-600 mb-2">{{ indicator.description }}</p>
                    <div class="flex flex-wrap gap-1 text-xs">
                      <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded">{{ indicator.numberType }}</span>
                      <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded">{{ indicator.numberFormat }}</span>
                      <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded" *ngIf="indicator.targetUnit">{{ indicator.targetUnit }}</span>
                      <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">{{ indicator.years.join(', ') }}</span>
                    </div>
                  </div>
                  <p-button icon="pi pi-plus" [text]="true" size="small" severity="help"></p-button>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="text-center py-6 text-gray-500">
            <i class="pi pi-info-circle text-lg mb-2 block"></i>
            <p class="text-sm">No indicators available yet.</p>
          </div>
        }
      </div>
    </div>
  }

  <div class="flex justify-end pt-4 border-t border-gray-200">
    <p-button
      label="Close"
      severity="secondary"
      size="small"
      (onClick)="
        setUpProjectService.assignIndicatorsModal.set({ show: false, target: { type: 'item', structureIndex: -1, itemIndex: -1 } })
      "></p-button>
  </div>
</p-dialog>
