<p-dialog
  header="Edit Structure Detail"
  (onHide)="clearBody()"
  [modal]="true"
  [(visible)]="setUpProjectService.structureDetailModal().show"
  [style]="{ width: '600px', maxHeight: '85vh' }"
  [draggable]="false"
  [closable]="true">

  <div class="structure-detail-content">
    <!-- Header Information Card -->
    <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 border border-blue-200 rounded-xl shadow-sm">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
          <i class="pi pi-cog text-white text-sm"></i>
        </div>
        <div>
          <h4 class="font-semibold text-gray-900 text-sm">Structure Configuration</h4>
          <p class="text-xs text-gray-600">Update the details and custom fields for this structure element</p>
        </div>
      </div>
    </div>

    <!-- Form Section -->
    <div class="space-y-4">
      <!-- Basic Information -->
      <div class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm">
        <div class="flex items-center space-x-2 mb-4">
          <i class="pi pi-info-circle text-blue-600 text-sm"></i>
          <h5 class="font-medium text-gray-900 text-sm">General Information</h5>
        </div>

        <div class="space-y-3">
          <app-input
            label="Code"
            [isRequired]="true"
            [validateEmpty]="true"
            [signal]="this.body"
            optionValue="code"
            placeholder="Enter structure code"
            [maxLength]="30"></app-input>

          <app-input
            label="Name"
            [isRequired]="true"
            [validateEmpty]="true"
            [signal]="this.body"
            optionValue="name"
            placeholder="Enter structure name"
            [maxLength]="30"></app-input>
        </div>
      </div>

      <!-- Custom Fields Section -->
      <div class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-2">
            <i class="pi pi-tags text-blue-600 text-sm"></i>
            <h5 class="font-medium text-gray-900 text-sm">Custom Fields</h5>
          </div>
          <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
            {{ this.body().custom_values?.length || 0 }} field{{ (this.body().custom_values?.length || 0) !== 1 ? 's' : '' }}
          </span>
        </div>

        @if (this.body().custom_values && this.body().custom_values.length > 0) {
          <div class="space-y-3">
            @for (customValue of this.body().custom_values; track $index) {
              <div class="p-3 bg-gray-50 rounded-lg border border-gray-100">
                <div class="flex items-center space-x-2 mb-2">
                  <i class="pi pi-tag text-gray-500 text-xs"></i>
                  <span class="text-xs font-medium text-gray-700">{{ customValue().field_name }}</span>
                </div>
                <app-input
                  [label]="customValue().field_name"
                  [isRequired]="true"
                  [validateEmpty]="true"
                  [signal]="customValue"
                  optionValue="field_value"
                  placeholder="Enter field value"
                  [maxLength]="30"></app-input>
              </div>
            }
          </div>
        } @else {
          <div class="text-center py-6 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
            <i class="pi pi-info-circle text-gray-400 text-lg mb-2"></i>
            <p class="text-sm text-gray-500">No custom fields available</p>
            <p class="text-xs text-gray-400">Custom fields are configured at the project level</p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Footer Actions -->
  <div class="flex justify-end gap-2 pt-4 border-t border-gray-200 mt-6">
    <p-button
      label="Cancel"
      severity="secondary"
      size="small"
      icon="pi pi-times"
      (click)="setUpProjectService.structureDetailModal.set({ show: false })" />
    <p-button
      label="Save Changes"
      size="small"
      icon="pi pi-check"
      (click)="saveStructure()" />
  </div>
</p-dialog>
