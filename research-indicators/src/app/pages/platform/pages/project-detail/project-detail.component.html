<ng-template #tableView>
  <div class="flex flex-col h-full min-w-0">
    @if (!setupProjectService.progressIndicatorsData().showSplitter) {
      <div class="w-full">
        <app-project-item [project]="currentProject()" ></app-project-item>
      </div>
    }
    <div class="w-full min-w-0 py-[8px] px-[8px] sm:py-[12px] sm:px-[12px] md:py-[20px] md:px-[24px]">
      <p-tabs [value]="lastSegment()">
        <p-tablist>
          @for (tab of tabs(); track tab.route) {
            @if (!tab.hidden) {
              <p-tab
                [value]="tab.route"
                (click)="onTabClick(tab)"
                (keydown.enter)="onTabClick(tab)"
                [routerLink]="tab.route === 'project-results' ? null : tab.route"
                class="flex items-center !gap-2 text-inherit">
                <span>{{ tab.label }}</span>
              </p-tab>
            }
          }
        </p-tablist>
      </p-tabs>
      <div class="w-full overflow-x-auto">
        @if (lastSegment() === 'project-results') {
          <div class="w-full">
            <app-results-center-table [showNewProjectResultButton]="true"></app-results-center-table>
          </div>
        } @else {
          <router-outlet />
        }
      </div>
    </div>
  </div>
</ng-template>

@if (setupProjectService.progressIndicatorsData().showSplitter) {
  <p-splitter [panelSizes]="[70, 30]" [minSizes]="[30, 20]" [style]="{ height: 'calc(100vh - 150px)' }" class="mb-8">
    <ng-template #panel>
      <ng-container *ngTemplateOutlet="tableView"></ng-container>
    </ng-template>

    <ng-template #panel>
      <div class="w-full h-full">
        <app-progress-detail-content></app-progress-detail-content>
      </div>
    </ng-template>
  </p-splitter>
} @else {
  <ng-container *ngTemplateOutlet="tableView"> </ng-container>
}

<app-section-sidebar
  [title]="'Table Filters'"
  [description]="'Filter your table data by applying custom criteria.'"
  [showSignal]="this.resultsCenterService.showFiltersSidebar"
  confirmText="Apply filters"
  (confirm)="this.resultsCenterService.applyFilters()">
  <app-table-filters-sidebar></app-table-filters-sidebar>
</app-section-sidebar>

<app-section-sidebar
  [title]="'Table Configuration'"
  [description]="'Customize your table by enabling, disabling, or reordering columns.'"
  [showSignal]="this.resultsCenterService.showConfigurationsSidebar"
  confirmText="Save table settings"
  (confirm)="sidebarConfigurations.applyConfigurations()">
  <app-table-configuration #sidebarConfigurations [excludedColumns]="['Platform', 'Reporting Project', 'Primary Lever']"></app-table-configuration>
</app-section-sidebar>
